"use strict";angular.module("protoApp",[]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("protoApp").controller("MainCtrl",["$scope",function(e){function t(){return JSON.parse(localStorage.data)}function n(t){t.stopPropagation(),t.preventDefault();for(var n,r=t.dataTransfer.files,s=[],a=0;n=r[a];a++)s.push("<li><strong>",escape(n.name),"</strong> (",n.type||"n/a",") - ",n.size," bytes, last modified: ",n.lastModifiedDate?n.lastModifiedDate.toLocaleDateString():"n/a","</li>");document.getElementById("list").innerHTML="<ul>"+s.join("")+"</ul>";for(var n,a=0;n=r[a];a++)if(n.type.match("image.*")){var i=new FileReader;i.onload=function(t){return function(n){var r=document.createElement("span");r.innerHTML=['<img class="thumb" src="',n.target.result,'" title="',escape(t.name),'"/>'].join(""),document.getElementById("list").insertBefore(r,null);var s=o();e.screens[s]={id:s,imageName:escape(t.name),imageData:n.target.result,hotspots:[]},e.set(e.screens)}}(n),i.readAsDataURL(n)}}function r(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function o(){var e,t,n=[],r="0123456789ABCDEF";for(e=0;36>e;e++)n[e]=Math.floor(16*Math.random());for(n[14]=4,n[19]=8|3&n[19],t=0;36>t;t++)n[t]=r[n[t]];return n[8]=n[13]=n[18]=n[23]="-",n.join("")}e.set=function(e){localStorage.data=JSON.stringify(e)};var s=!1,a=null,i=null;if(void 0===localStorage.data){var c={};e.set(c)}e.screens=t(),e.screenList=_.keys(e.screens),e.screenList=_.map(e.screenList,function(t){return{id:t,imageData:e.screens[t].imageData}}),e.editMode=!0,e.changeMode=function(){e.editMode=!e.editMode},e.changeScreen=function(t){console.log(t),e.screen=e.screens[t],console.log(e.screen)},e.addSpot=function(t,n){e.screens[n].hotspots.push({top:t.offsetY,left:t.offsetX,width:150,height:30,target:null}),e.set(e.screens)},e.deleteSpot=function(t,n){e.screens[t].hotspots.splice(n,1),e.set(e.screens)},e.selectTarget=function(e,t){s=!0,a=e,i=t},e.selectScreen=function(t){s?(e.screens[a].hotspots[i].target=t,s=!1,a=null,i=null,e.set(e.screens)):e.changeScreen(t)};var l=document.getElementById("drop_zone");l.addEventListener("dragover",r,!1),l.addEventListener("drop",n,!1)}]),angular.module("protoApp").directive("draggable",function(){return{restrict:"A",link:function(e,t,n){$(t).draggable({handle:"span.handle",stop:function(t,r){e.$parent.screens[n.screen].hotspots[n.id].top=r.position.top,e.$parent.screens[n.screen].hotspots[n.id].left=r.position.left,console.log(e.$parent.screens[n.screen].hotspots[n.id]),e.$parent.set(e.$parent.screens)}})}}}),angular.module("protoApp").directive("resizable",function(){return{restrict:"A",link:function(e,t,n){$(t).resizable({stop:function(t,r){e.$parent.screens[n.screen].hotspots[n.id].width=r.size.width,e.$parent.screens[n.screen].hotspots[n.id].height=r.size.height,console.log(e.$parent.screens[n.screen].hotspots[n.id]),e.$parent.set(e.$parent.screens)}})}}}),angular.module("protoApp").directive("popover",function(){return{restrict:"A",link:function(e,t){$(t).popover()}}});